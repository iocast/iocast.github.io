<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="chrome=1" />
        <title>iocast ~ hook-server</title>
        
        <link rel="stylesheet" href="/assets/stylesheets/styles.css" />
        <link rel="stylesheet" href="/assets/stylesheets/pygment_trac.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        
        <script src="/assets/javascripts/jquery-2.0.3.min.js"></script>

        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="wrapper">
            <header>
                <h1>iocast <a href="/"><small>iocast.github.io</small></a></h1>
                
                <p class="view"><a href="/projects.html">Projects <small>by iocast</small></a></p>
                <p class="view"><a href="/posts.html">Blog</a> <a href="/atom.xml"><small>atom feed</small></a></p>
                <p class="view"><a href="/wiki">Wiki <small>powered by TiddlyWiki</small></a></p>
                
                
                <h3>Project Info</h3>
                <ul>
                    
                    <li><a href="https://github.com/iocast/hook-server/zipball/master">Download <strong>ZIP File</strong></a></li>
                    
                    
                    
                    
                    <li><a href="https://github.com/iocast/hook-server/issues/new">Report<strong>An Issue</strong></a></li>
                    
                    
                    <li><a href="http://github.com/iocast/hook-server">Fork On <strong>GitHub</strong></a></li>
                    
                </ul>
                
                
                <h3>Find me on ...</h3>
                <p class"view"><a href="http://github.com/iocast">GitHub</a><br/>
                <a href="http://bitbucket.org/iocast">BitBucket</a><br/>
                <a href="http://twitter.com/MichelOtt2">Twitter</a><br/>
                <a href="http://osrc.dfm.io/iocast">Open Source Report Card</a><br/></p>
                
                <!--
                <h3>Miscellaneous</h3>
                <p class="view"><a href="/bibliography.html">Bibliography</a></p>
                 -->
                
            </header>
            <section>
                <a name="hook-server"></a>
<h1>hook-server</h1>

<p>hook-server is a Python server which updates a git repository triggered by a post hook comming from <a href="https://developer.github.com/webhooks/">GitHub</a> or <a href="https://confluence.atlassian.com/display/BITBUCKET/Manage+Bitbucket+hooks">Bitbucket</a>.</p>

<a name="installation"></a>
<h2>installation</h2>

<p>For both methods described below you could use a virtual environment. So lets first create a <code>virtualenv</code> and install the necessary dependencies:</p>

<pre><code>virtualenv /opt/virtualenv/hook-server-hook
source /opt/virtualenv/hook-server/bin/activate
pip install bottle
deactivate
</code></pre>

<a name="standalone"></a>
<h3>standalone</h3>

<p>A script is provided to run this server in standalone mode.</p>

<pre><code>sudo -u www-data python hook-server_standalone.py --port 8080 --host localhost --virtualenv /opt/virtualenv/hook-server
</code></pre>

<a name="nginx..uwsgi"></a>
<h3>nginx, uwsgi</h3>

<p>In the <code>hook-server_nginx_site.conf</code> change the <code>server_name</code>, <code>root</code> which is your home directory of the application, as well as the <code>listen</code> parameter.</p>

<p>Now change i nthe <code>hook-server_uwsgi_vassal.xml</code> the path to your virtual environement which is the key <code>virtualenv</code> and if necessary the path to the log <code>daemonize</code>.</p>

<p>In my environment I use <code>upstart</code> to control my services. For uwsgi I have craeted a <code>uwsgi.conf</code> in <code>/etc/init</code> with the following content</p>

<pre><code># uWSGI - manage uWSGI application server
#

description     "uWSGI Emperor"

start on (filesystem and net-device-up IFACE=lo)
stop on runlevel [!2345]

respawn

env LOGTO=/var/log/uwsgi/uwsgi.log
env BINPATH=/usr/bin/uwsgi

pre-start script
        mkdir -p -m0755 /var/run/uwsgi
end script

exec $BINPATH --emperor /opt/www/vassals/ --pidfile /var/run/uwsgi/emperor.pid --stats 127.0.0.1:9191 --logto $LOGTO
</code></pre>

<p>that creates a <code>/var/run/uwsgi</code> folder for the <code>pid</code> files and starts the applications using the configuration file in <code>/opt/www/vassals/</code>.</p>

<p>In this case, create a link of the <strong>nginx site configuration</strong> to the nginxs' site directory and a link of the <strong>vassal</strong> file to the emperor directory.</p>

<pre><code>ln -s /opt/www/hook-server_nginx_site.conf /etc/nginx/sites-available/hook-server
ln -s /etc/nginx/sites-available/hook-server /etc/nginx/sites-enabled/
ln -s /opt/www/hook-server_uwsgi_vassal.xml /opt/www/vassals/hook-server.xml
</code></pre>

            </section>
            <footer>
                <p><small>Hosted on GitHub &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
            </footer>
        </div>
        <script src="/assets/javascripts/scale.fix.js"></script>
    </body>
</html>