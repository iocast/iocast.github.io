<!doctype html>
<html lang="en-US">
	<head>
			<meta charset="utf-8" />
	
  <title>Setting up a QGIS server and PostGIS on CentOS 6 | iocast&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


	
		<link rel="icon" href="/favicon.png">
	


	<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/jquery.mixitup.min.js" type="text/javascript"></script>
<script src="/js/stickyfill.js" type="text/javascript"></script>

	<!--CDN links for the latest TweenLite, CSSPlugin, and EasePack-->
	<script src="http://www.greensock.com/js/src/utils/SplitText.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/plugins/CSSPlugin.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/easing/EasePack.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TimelineLite.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenLite.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.4/hammer.min.js"></script>


	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">


	
		<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
		<script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
		
		<link rel="stylesheet" href="/css/post.css" type="text/css">
		<script src="/js/post.js" type="text/javascript"></script>
	

	<link rel="stylesheet" href="/css/style.css" type="text/css">

	</head>
	<body>
		
<div class="wrapper cf">
	<div class="content article-entry">
		<header>
			<h1>Setting up a QGIS server and PostGIS on CentOS 6</h1>
		</header>
		<small>
			
				<a href="http://localhost:4000/categories/GIS/" rel="tag tooltip" class="label light" data-placement="right" data-original-title="2 articles in this category"><i class="fa fa-dot-circle-o"></i> GIS</a>
			
      <a href="http://localhost:4000/en/2013/10/12/gis/qgis-server-centos.html#disqus_thread" class="scrollTo label label-default light" data-disqus-identifier="blog/2014/07/21-javascript-internationalization-part1.html"><i class="fa fa-comment-o"></i> ?? Comments</a>
      <span class="label label-default light">21/Jul/2014 Mon</span>
    </small>

		<p>QGIS server provides a web map server (WMS) by simply copying a QGIS project int the server directory. If you want to depend on newer <code>postgresql-libs</code> you need first to install the desired version of PostgreSQL and PostGIS as described bellow.</p>
<h2 id="PostgreSQL_and_PostGIS"><a href="#PostgreSQL_and_PostGIS" class="headerlink" title="PostgreSQL and PostGIS"></a>PostgreSQL and PostGIS</h2><p>The following instructions are adapted from  <a href="http://wiki.postgresql.org/wiki/YUM_Installation#Configure_your_YUM_repository">YUM installation - PostgreSQL wiki</a> and <a href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostGIS20CentOS6pgdg">UsersWikiuPostGIS20CentOS6pgdg - PostGIS</a>.</p>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>Configure yum repository</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/yum.repos.d/CentOS-Base.repo</span><br></pre></td></tr></table></figure>
<p>and add the following excludes to <code>base</code> and <code>updates</code> sections:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">exclude=postgresql*</span><br></pre></td></tr></table></figure>
<h3 id="Install_PGDG_RPM_file"><a href="#Install_PGDG_RPM_file" class="headerlink" title="Install PGDG RPM file"></a>Install PGDG RPM file</h3><p>A PGDG file is available for each distribution/architecture/database version combination at <a href="http://yum.postgresql.org">http://yum.postgresql.org</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://yum.postgresql.org/&lt;version&gt;/&lt;distribution&gt;/&lt;architecture&gt;/pgdg-&lt;database&gt;.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>where version is <code>9.3</code>, distribution is <code>redhat</code>, architecture is <code>rhel-6-x86_64</code> and database is <code>centos93-9.3-1</code>.</p>
<p>Install RPM distribution:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm -ivh pgdg-centos93-<span class="number">9.3</span>-<span class="number">1</span>.noarch.rpm</span><br></pre></td></tr></table></figure>
<h3 id="Installation_of_PostgreSQL_and_PostGIS"><a href="#Installation_of_PostgreSQL_and_PostGIS" class="headerlink" title="Installation of PostgreSQL and PostGIS"></a>Installation of PostgreSQL and PostGIS</h3><p>List the available packages:</p>
<pre><code>:::bash
yum list postgres*
</code></pre><p>Installation:</p>
<pre><code>:::bash
yum install postgresql93-libs.x86_64 postgresql93-server.x86_64 postgresql93-devel.x86_64 postgis2_93
</code></pre><h3 id="Configuration-1"><a href="#Configuration-1" class="headerlink" title="Configuration"></a>Configuration</h3><p>Now perform a few post-installation setup commands, in the order: (1) Initialize the database cluster (required), (2) start database (recommended, if you want to use it straight away), (3) allow it to start-up automatically on reboot (recommended):</p>
<pre><code>:::bash
service postgresql-9.3 initdb
service postgresql-9.3 start
chkconfig postgresql-9.3 on
</code></pre><p>Some important files</p>
<table>
<thead>
<tr>
<th style="text-align:left">File / Application</th>
<th style="text-align:left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">/var/lib/pgsql/9.3/data/postgresql.conf</td>
<td style="text-align:left">changing host etc.</td>
</tr>
<tr>
<td style="text-align:left">/var/lib/pgsql/9.3/data/pg_hba.conf</td>
<td style="text-align:left">client authentication configuration</td>
</tr>
</tbody>
</table>
<p>In the <code>pg_hba.conf</code> file comment out the <code>ident</code> lines except for unix domain socket and add two new lines for <code>md5 encryption</code></p>
<pre><code>:::yaml
# IPv4 local connections:
#host    all             all             127.0.0.1/32            ident
host    all             all             127.0.0.1/32            md5
# IPv6 local connections:
#host    all             all             ::1/128                 ident
host    all             all             ::1/128                 md5
</code></pre><h3 id="Database_and_User"><a href="#Database_and_User" class="headerlink" title="Database and User"></a>Database and User</h3><p>Before we can start, we need to create a new database and user.</p>
<p>Login as <code>postgres</code> superuser and create a new database</p>
<pre><code>:::bash
su -l postgres
createdb gis
</code></pre><p>Login into the database create a user and set a encrypted password</p>
<pre><code>:::bash
psql gis
CREATE USER gis WITH SUPERUSER LOGIN PASSWORD &apos;gis&apos;;
ALTER USER gis WITH ENCRYPTED PASSWORD &apos;gis&apos;;
</code></pre><p>Now test your configuration and install PostGIS extension</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">psql -h localhost <span class="operator">-d</span> gis -U gis -W</span><br><span class="line">CREATE EXTENSION postgis;</span><br></pre></td></tr></table></figure>
<h2 id="Installation_QGIS"><a href="#Installation_QGIS" class="headerlink" title="Installation QGIS"></a>Installation QGIS</h2><p>First you need a running CentOS on a machine. In the default CentOS software repository <code>qgis-server</code> is not available. So you need first to add extra packages for enterprise linux (EPEL) repository as follow:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://dl.fedoraproject.org/pub/epel/<span class="number">6</span>/x86_64/epel-release-&lt;version&gt;.noarch.rpm</span><br><span class="line">rpm -Uvh epel-release-&lt;version&gt;.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>where the version I have tested it was <code>6-8</code>.</p>
<p>Add the ELGIS repositories</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://elgis.argeo.org/repos/<span class="number">6</span>/elgis-release-&lt;version&gt;.noarch.rpm</span><br><span class="line">rpm -Uvh elgis-release-<span class="number">6</span>-<span class="number">6</span>_0.noarch.rpm</span><br></pre></td></tr></table></figure>
<p>where the version I have tested it was <code>6-6_0</code>.</p>
<p>Now install QGIS server:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install qgis-mapserver.x86_64</span><br></pre></td></tr></table></figure>
<p>If you want to have QGIS libraries, QGIS Desktop run the following command</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install qgis*</span><br></pre></td></tr></table></figure>
<p>The scripts and configs are installed on CentOS:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Script / Config</th>
<th style="text-align:left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">/usr/libexec/qgis/qgis_mapserv.fcgi</td>
<td style="text-align:left">main fast cgi script (OGC capabilities)</td>
</tr>
<tr>
<td style="text-align:left">/etc/httpd/conf.d/qgis-mapserver.conf</td>
<td style="text-align:left">qgis mapserver httpd configuration file</td>
</tr>
</tbody>
</table>

	</div>
	<div id="sidebar" class="sidebar">
		<h3>Table of Content</h3>
		<nav class="toc">
			<ol class="toc-item"><li class="toc-item-item toc-item-level-2"><a class="toc-item-link" href="#PostgreSQL_and_PostGIS"><span class="toc-item-text">PostgreSQL and PostGIS</span></a><ol class="toc-item-child"><li class="toc-item-item toc-item-level-3"><a class="toc-item-link" href="#Configuration"><span class="toc-item-text">Configuration</span></a></li><li class="toc-item-item toc-item-level-3"><a class="toc-item-link" href="#Install_PGDG_RPM_file"><span class="toc-item-text">Install PGDG RPM file</span></a></li><li class="toc-item-item toc-item-level-3"><a class="toc-item-link" href="#Installation_of_PostgreSQL_and_PostGIS"><span class="toc-item-text">Installation of PostgreSQL and PostGIS</span></a></li><li class="toc-item-item toc-item-level-3"><a class="toc-item-link" href="#Configuration-1"><span class="toc-item-text">Configuration</span></a></li><li class="toc-item-item toc-item-level-3"><a class="toc-item-link" href="#Database_and_User"><span class="toc-item-text">Database and User</span></a></li></ol></li><li class="toc-item-item toc-item-level-2"><a class="toc-item-link" href="#Installation_QGIS"><span class="toc-item-text">Installation QGIS</span></a></li></ol>
		</nav>
	</div>
</div>

	</body>
</html>
