<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=description content="blog, cheatsheets, best practices, notes, and more"><meta name=author content=iocast><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><title>PostgreSQL -- think twice code once!</title><script src=https://iocast.github.io/libs/smoothscroll.min.js></script><link rel=stylesheet type=text/css href=https://iocast.github.io/semantic/semantic.min.css><script src=https://iocast.github.io/libs/jquery-3.3.1.min.js></script><script src=https://iocast.github.io/semantic/semantic.min.js></script><script src=https://iocast.github.io/libs/masonry.pkgd.min.js></script><script>$(document).ready(function(){$('.masthead').visibility({once:false,onBottomPassed:function(){$('.fixed.menu').transition('fade in');},onBottomPassedReverse:function(){$('.fixed.menu').transition('fade out');}});$('.ui.sidebar').sidebar('attach events','.toc.item');});</script><link rel=stylesheet type=text/css href=https://iocast.github.io/css/syntax.css><link rel=stylesheet type=text/css href=https://iocast.github.io/css/main.css></head><body><div class="ui large top fixed hidden menu"><div class="ui container"><a class=item href=https://iocast.github.io/>Home</a>
<a class=item href=https://iocast.github.io/post/>Archives</a>
<a class="active item" href=https://iocast.github.io/cheatsheet/>Cheatsheets</a></div></div><div class="ui vertical inverted sidebar menu"><a class=item href=https://iocast.github.io/>Home</a>
<a class=item href=https://iocast.github.io/post/>Archives</a>
<a class="active item" href=https://iocast.github.io/cheatsheet/>Cheatsheets</a></div><div class=pusher><div class="ui inverted vertical masthead center aligned segment"><div class="ui container"><div class="ui large secondary inverted pointing menu"><a class="toc item"><i class="sidebar icon"></i></a><a class=item href=https://iocast.github.io/>Home</a>
<a class=item href=https://iocast.github.io/post/>Archives</a>
<a class="active item" href=https://iocast.github.io/cheatsheet/>Cheatsheets</a></div></div><div class="ui text container"><h1 class="ui inverted header">POSTGRESQL</h1><div class=abstract>PostgreSQL commands</div></div></div><div class="ui vertical stripe segment"><div class="ui middle aligned stackable grid container"><div class=row><div class="sixteen  wide column"><div class="main ui container sticky--container"><div class="ui dividing right rail"><div class="ui sticky"><h4 class="ui header">PostgreSQL</h4><nav id=TableOfContents><ul><li><ul><li><a href=#basics>Basics</a><ul><li><a href=#list>List</a></li><li><a href=#create>Create</a></li><li><a href=#drop>Drop</a></li><li><a href=#log-into-database>Log into database</a></li><li><a href=#user>User</a></li><li><a href=#export-to-file>Export To File</a></li></ul></li><li><a href=#commands>Commands</a></li><li><a href=#extensions>Extensions</a><ul><li><a href=#hstore>Hstore</a></li><li><a href=#postgis>PostGIS</a></li></ul></li><li><a href=#sql>SQL</a></li><li><a href=#issues>Issues</a><ul><li><a href=#full-disk>Full Disk</a></li></ul></li></ul></li></ul></nav></div></div><div><h2 class="ui header" id=basics>Basics</h2><p>login as postgres use r</p><div class=highlight><pre class=chroma>sudo su postgres -</pre></div><p>run sql command</p><div class=highlight><pre class=chroma>psql -U postgres -c &#34;&lt;sql&gt;&#34;</pre></div><h3 class="ui header" id=list>List</h3><p>lists all databases</p><div class=highlight><pre class=chroma>psql --list</pre></div><h3 class="ui header" id=create>Create</h3><p>create database</p><dl><dt><code>-O</code></dt><dd>owner</dd><dt><code>-U</code></dt><dd>username</dd><dt><code>-E</code></dt><dd>encoding</dd><dt><code>-e</code></dt><dd>echo</dd><dt><code>--locale=&lt;locale&gt;</code></dt><dd>(This is equivalent to specifying both <code>--lc-collate</code> and <code>--lc-ctype</code>)</dd><dt><code>--lc-collate='&lt;locale&gt;'</code></dt><dd>collation order</dd><dt><code>--lc-ctype='&lt;locale&gt;'</code></dt><dd>character classification</dd><dt><code>-T</code></dt><dd>template</dd></dl><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>createdb -U postgres &lt;database&gt;</code></pre></div><h3 class="ui header" id=drop>Drop</h3><div class=highlight><pre class=chroma>dropdb -U &lt;user&gt; -h &lt;host&gt; -i -e &lt;database&gt;</pre></div><h3 class="ui header" id=log-into-database>Log into database</h3><p><code>-W</code> to force password prompt</p><div class=highlight><pre class=chroma>psql -U &lt;user&gt; -W -d &lt;database&gt;</pre></div><h3 class="ui header" id=user>User</h3><p>create user</p><dl><dt><code>-D</code></dt><dd>(The new user will not be allowed to create databases.)</dd><dt><code>-P</code></dt><dd>(If given, createuser will issue a prompt for the password of the new user. This is not necessary if you do not plan on using password authentication.)</dd><dt><code>-S</code></dt><dd>(The new user will not be a superuser.)</dd><dt><code>-E</code></dt><dd>(Encrypts the user&rsquo;s password stored in the database. If not specified, the default password behavior is used.)</dd></dl><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>createuser -D -S -E -P &lt;name&gt;</code></pre></div><h3 class="ui header" id=export-to-file>Export To File</h3><p><code>\h copy</code> tells you what are the parameters for export</p><div class=highlight><pre class=chroma>COPY (&lt;sql&gt;) TO &#39;&lt;file&gt;&#39; CSV</pre></div><h2 class="ui header" id=commands>Commands</h2><p>load environment</p><div class=highlight><pre class=chroma>psql</pre></div><p>list all users</p><div class=highlight><pre class=chroma>\dg</pre></div><p>list all databases</p><div class=highlight><pre class=chroma>\list</pre></div><p>list all tables</p><div class=highlight><pre class=chroma>\dp</pre></div><p>table schema</p><div class=highlight><pre class=chroma>\d &lt;table&gt;</pre></div><p>cancel/go out</p><div class=highlight><pre class=chroma>CTRL+D</pre></div><h2 class="ui header" id=extensions>Extensions</h2><p>Connect to the PostgreSQL server</p><div class=highlight><pre class=chroma>psql -h localhost</pre></div><p>create a database</p><div class=highlight><pre class=chroma>CREATE DATABASE mydatabase;</pre></div><p>and connect to it</p><div class=highlight><pre class=chroma>\c mydatabase</pre></div><h3 class="ui header" id=hstore>Hstore</h3><p>creates / loads hstore extension for the current database</p><div class=highlight><pre class=chroma>CREATE EXTENSION hstore;</pre></div><h3 class="ui header" id=postgis>PostGIS</h3><p>creates / load postgis extension for the current database</p><div class=highlight><pre class=chroma>CREATE EXTENSION postgis;</pre></div><h2 class="ui header" id=sql>SQL</h2><p>grant access</p><div class=highlight><pre class=chroma>ALTER DATABASE &lt;name&gt; OWNER TO &lt;user&gt;</pre></div><h2 class="ui header" id=issues>Issues</h2><h3 class="ui header" id=full-disk>Full Disk</h3><p>Locate the directory which uses that much space on the disk. On a standard installation it is somewhere in the <code>/var/lib/</code> directory. If found the PostgreSQL data directory (here as example <code>/var/lib/pgsql</code> run the following command to find out which directory needs how much space on the disk</p><div class=highlight><pre class=chroma>du -h</pre></div><p>First stop PostgreSQL</p><div class=highlight><pre class=chroma>/etc/init.d/postgresql stop</pre></div><p>Then move a &ldquo;big&rdquo; directory to a partition/disk that has space free.</p><div class=highlight><pre class=chroma>mv /var/lib/pgsql/main/ /media/tmp/</pre></div><p>Now create a symlink to this directory</p><div class=highlight><pre class=chroma>ln -s /medai/tmp/main /var/lib/pgsql/main</pre></div><p>Start PostgreSQL</p><div class=highlight><pre class=chroma>/etc/init.d/postgresql start</pre></div><p>and VACUUM FULL</p><div class=highlight><pre class=chroma>psql -c &#34;VACUUM FULL&#34;</pre></div><p>Shutdown the database.</p><div class=highlight><pre class=chroma>/etc/init.d/postgresql stop</pre></div><p>Remove the symbolic link</p><div class=highlight><pre class=chroma>unlink /var/lib/pgsql/main</pre></div><p>and move the files back onto the <code>/var/lib/pgsql</code> filesystem again</p><div class=highlight><pre class=chroma>mv /media/tmp/main/ /var/lib/pgsql/</pre></div><p>Now you are finished. Start the database.</p><div class=highlight><pre class=chroma>/etc/init.d/postgresql start</pre></div></div></div><script>$('.ui.sticky').sticky({context:'.sticky--container',offset:56});</script></div></div></div></div></div><script src=https://iocast.github.io/main.js></script></body></html>