<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="chrome=1" />
        <title>icoast ~ Setting up a QGIS server and PostGIS on CentOS 6</title>
        
        <link rel="stylesheet" href="/assets/stylesheets/styles.css" />
        <link rel="stylesheet" href="/assets/stylesheets/pygment_trac.css" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        
        <script src="/assets/javascripts/jquery-2.0.3.min.js"></script>

        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    <body>
        <div class="wrapper">
            <header>
                <h1>iocast <a href="/"><small>iocast.github.io</small></a></h1>
                
                <p class="view"><a href="/projects.html">Projects <small>by iocast</small></a></p>
                <p class="view"><a href="/posts.html">Blog</a> <a href="/atom.xml"><small>atom feed</small></a></p>
                
                
                
                <h3>Find me on ...</h3>
                <p class"view"><a href="http://github.com/iocast">GitHub</a><br/>
                <a href="http://bitbucket.org/iocast">BitBucket</a><br/>
                <a href="http://twitter.com/MichelOtt2">Twitter</a><br/>
                <a href="http://osrc.dfm.io/iocast">Open Source Report Card</a><br/></p>
                
                <!--
                <h3>Miscellaneous</h3>
                <p class="view"><a href="/bibliography.html">Bibliography</a></p>
                 -->
                
            </header>
            <section>
                <article>
<h1>icoast ~ Setting up a QGIS server and PostGIS on CentOS 6</h1>
<div class="meta_wrapper">
    <time datetime="2013-10-12">October 12, 2013</time>
    <ul class="tag_list_in_post">
    
        <li class="inline tag_list_item"><a class="tag_list_link" href="/tag/centos">centos</a></li>
    
        <li class="inline tag_list_item"><a class="tag_list_link" href="/tag/qgis">qgis</a></li>
    
        <li class="inline tag_list_item"><a class="tag_list_link" href="/tag/server">server</a></li>
    
        <li class="inline tag_list_item"><a class="tag_list_link" href="/tag/postgresql">postgresql</a></li>
    
        <li class="inline tag_list_item"><a class="tag_list_link" href="/tag/postgis">postgis</a></li>
    
    </ul>
</div>


<p>QGIS server provides a web map server (WMS) by simply copying a QGIS project int the server directory. If you want to depend on newer <code>postgresql-libs</code> you need first to install the desired version of PostgreSQL and PostGIS as described bellow.</p>

<a name="PostgreSQL.and.PostGIS"></a>
<h2>PostgreSQL and PostGIS</h2>

<p>The following instructions are adapted from  <a href="http://wiki.postgresql.org/wiki/YUM_Installation#Configure_your_YUM_repository">YUM installation - PostgreSQL wiki</a> and <a href="http://trac.osgeo.org/postgis/wiki/UsersWikiPostGIS20CentOS6pgdg">UsersWikiuPostGIS20CentOS6pgdg - PostGIS</a>.</p>

<a name="Configuration"></a>
<h3>Configuration</h3>

<p>Configure yum repository</p>

<div class="highlight"><pre><code class="bash">vi /etc/yum.repos.d/CentOS-Base.repo
</code></pre></div>


<p>and add the following excludes to <code>base</code> and <code>updates</code> sections:</p>

<div class="highlight"><pre><code class="yaml"><span class="l-Scalar-Plain">exclude=postgresql*</span>
</code></pre></div>


<a name="Install.PGDG.RPM.file"></a>
<h3>Install PGDG RPM file</h3>

<p>A PGDG file is available for each distribution/architecture/database version combination at <a href="http://yum.postgresql.org">http://yum.postgresql.org</a></p>

<div class="highlight"><pre><code class="bash">wget http://yum.postgresql.org/&lt;version&gt;/&lt;distribution&gt;/&lt;architecture&gt;/pgdg-&lt;database&gt;.noarch.rpm
</code></pre></div>


<p>where version is <code>9.3</code>, distribution is <code>redhat</code>, architecture is <code>rhel-6-x86_64</code> and database is <code>centos93-9.3-1</code>.</p>

<p>Install RPM distribution:</p>

<div class="highlight"><pre><code class="bash">rpm -ivh pgdg-centos93-9.3-1.noarch.rpm
</code></pre></div>


<a name="Installation.of.PostgreSQL.and.PostGIS"></a>
<h3>Installation of PostgreSQL and PostGIS</h3>

<p>List the available packages:</p>

<div class="highlight"><pre><code class="bash">yum list postgres*
</code></pre></div>


<p>Installation:</p>

<div class="highlight"><pre><code class="bash">yum install postgresql93-libs.x86_64 postgresql93-server.x86_64 postgresql93-devel.x86_64 postgis2_93
</code></pre></div>


<a name="Configuration"></a>
<h3>Configuration</h3>

<p>Now perform a few post-installation setup commands, in the order: (1) Initialize the database cluster (required), (2) start database (recommended, if you want to use it straight away), (3) allow it to start-up automatically on reboot (recommended):</p>

<div class="highlight"><pre><code class="bash">service postgresql-9.3 initdb
service postgresql-9.3 start
chkconfig postgresql-9.3 on
</code></pre></div>


<p>Some important files</p>

<table>
<thead>
<tr>
<th style="text-align:left;">File / Application                       </th>
<th style="text-align:left;"> Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">/var/lib/pgsql/9.3/data/postgresql.conf  </td>
<td style="text-align:left;"> changing host etc.</td>
</tr>
<tr>
<td style="text-align:left;">/var/lib/pgsql/9.3/data/pg_hba.conf      </td>
<td style="text-align:left;"> client authentication configuration</td>
</tr>
</tbody>
</table>


<p>In the <code>pg_hba.conf</code> file comment out the <code>ident</code> lines except for unix domain socket and add two new lines for <code>md5 encryption</code></p>

<div class="highlight"><pre><code class="yaml"><span class="c1"># IPv4 local connections:</span>
<span class="c1">#host    all             all             127.0.0.1/32            ident</span>
<span class="l-Scalar-Plain">host    all             all             127.0.0.1/32            md5</span>
<span class="l-Scalar-Plain"># IPv6 local connections</span><span class="p-Indicator">:</span>
<span class="c1">#host    all             all             ::1/128                 ident</span>
<span class="l-Scalar-Plain">host    all             all             ::1/128                 md5</span>
</code></pre></div>


<a name="Database.and.User"></a>
<h3>Database and User</h3>

<p>Before we can start, we need to create a new database and user.</p>

<p>Login as <code>postgres</code> superuser and create a new database</p>

<div class="highlight"><pre><code class="bash">su -l postgres
createdb gis
</code></pre></div>


<p>Login into the database create a user and set a encrypted password</p>

<div class="highlight"><pre><code class="bash">psql gis
CREATE USER gis WITH SUPERUSER LOGIN PASSWORD <span class="s1">&#39;gis&#39;</span>;
ALTER USER gis WITH ENCRYPTED PASSWORD <span class="s1">&#39;gis&#39;</span>;
</code></pre></div>


<p>Now test your configuration and install PostGIS extension</p>

<div class="highlight"><pre><code class="bash">psql -h localhost -d gis -U gis -W
CREATE EXTENSION postgis;
</code></pre></div>


<a name="Installation.QGIS"></a>
<h2>Installation QGIS</h2>

<p>First you need a running CentOS on a machine. In the default CentOS software repository <code>qgis-server</code> is not available. So you need first to add extra packages for enterprise linux (EPEL) repository as follow:</p>

<div class="highlight"><pre><code class="bash">wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-&lt;version&gt;.noarch.rpm
rpm -Uvh epel-release-&lt;version&gt;.noarch.rpm
</code></pre></div>


<p>where the version I have tested it was <code>6-8</code>.</p>

<p>Add the ELGIS repositories</p>

<div class="highlight"><pre><code class="bash">wget http://elgis.argeo.org/repos/6/elgis-release-&lt;version&gt;.noarch.rpm
rpm -Uvh elgis-release-6-6_0.noarch.rpm
</code></pre></div>


<p>where the version I have tested it was <code>6-6_0</code>.</p>

<p>Now install QGIS server:</p>

<div class="highlight"><pre><code class="bash">yum install qgis-mapserver.x86_64
</code></pre></div>


<p>If you want to have QGIS libraries, QGIS Desktop run the following command</p>

<div class="highlight"><pre><code class="bash">yum install qgis*
</code></pre></div>


<p>The scripts and configs are installed on CentOS:</p>

<table>
<thead>
<tr>
<th style="text-align:left;">Script / Config                       </th>
<th style="text-align:left;"> Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">/usr/libexec/qgis/qgis_mapserv.fcgi   </td>
<td style="text-align:left;"> main fast cgi script (OGC capabilities)</td>
</tr>
<tr>
<td style="text-align:left;">/etc/httpd/conf.d/qgis-mapserver.conf </td>
<td style="text-align:left;"> qgis mapserver httpd configuration file</td>
</tr>
</tbody>
</table>


</article>

            </section>
            <footer>
                <p><small>Hosted on GitHub &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
            </footer>
        </div>
        <script src="/assets/javascripts/scale.fix.js"></script>
    </body>
</html>